<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Ondas Logísticas - ML Style</title>
    <!-- Bibliotecas externas via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #EBEBEB; /* Cinza Mercado Livre */
        }
        .animate-progress { transition: width 1s linear; }
        
        /* Cores Customizadas Mercado Livre */
        .bg-ml-yellow { background-color: #FFE600; }
        .text-ml-yellow { color: #FFE600; }
        .border-ml-yellow { border-color: #FFE600; }
        .bg-ml-blue { background-color: #3483FA; }
        .text-ml-blue { color: #3483FA; }
        .border-ml-blue { border-color: #3483FA; }
        
        /* Ajuste para o fundo cinza ML */
        .ml-card {
            background-color: #FFFFFF;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,.1);
        }
    </style>
</head>
<body class="text-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const Icons = {
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            RotateCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Volume2: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            VolumeX: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            ArrowLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
            Package: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M16.5 9.4 7.5 4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.29 7 12 12 20.71 7"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Bell: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
            Bullhorn: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M11 5L6 9H2V15H6L11 19V5Z"/><path d="M19.07 4.93C20.94 6.81 22 9.33 22 12C22 14.67 20.94 17.19 19.07 19.07"/><path d="M15.54 8.46C16.47 9.4 17 10.66 17 12C17 13.34 16.47 14.6 15.54 15.54"/></svg>,
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        };

        const App = () => {
            const [view, setView] = useState('timer');
            const [waves, setWaves] = useState([
                { id: 1, name: 'Onda 1', duration: 30 * 60, startTime: '12:30' },
                { id: 2, name: 'Onda 2', duration: 20 * 60, startTime: '13:00' },
                { id: 3, name: 'Onda 3', duration: 20 * 60, startTime: '13:20' },
                { id: 4, name: 'Onda 4', duration: 20 * 60, startTime: '13:40' },
                { id: 5, name: 'Onda 5', duration: 20 * 60, startTime: '14:00' },
                { id: 6, name: 'Onda 6', duration: 20 * 60, startTime: '14:20' },
                { id: 7, name: 'Onda 7', duration: 5 * 60, startTime: '14:40' },
            ]);

            const [alarmTriggerMinutes, setAlarmTriggerMinutes] = useState(1);
            const [alarmRepeatSeconds, setAlarmRepeatSeconds] = useState(45);
            const [isHornEnabled, setIsHornEnabled] = useState(true);
            
            const [isAutoStartEnabled, setIsAutoStartEnabled] = useState(false);
            const [scheduledStartTime, setScheduledStartTime] = useState("12:30");
            const [systemTime, setSystemTime] = useState(new Date().toLocaleTimeString('pt-PT', {hour: '2-digit', minute:'2-digit'}));

            const [availableVoices, setAvailableVoices] = useState([]);
            const [selectedVoiceName, setSelectedVoiceName] = useState('');
            const [activeWaveIndex, setActiveWaveIndex] = useState(0);
            const [timeLeft, setTimeLeft] = useState(waves[0].duration);
            const [isRunning, setIsRunning] = useState(false);
            const [isMuted, setIsMuted] = useState(false);
            
            const timerRef = useRef(null);

            // Função auxiliar para somar minutos a um horário "HH:mm"
            const addMinutesToTime = (timeStr, mins) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                const date = new Date();
                date.setHours(hours, minutes + Math.floor(mins), (mins % 1) * 60);
                return date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            };

            // Efeito para Recalcular os Horários de Início das Ondas baseado em encadeamento direto
            useEffect(() => {
                const updatedWaves = [...waves];
                let changed = false;

                // A primeira onda segue o horário agendado
                if (updatedWaves[0].startTime !== scheduledStartTime) {
                    updatedWaves[0].startTime = scheduledStartTime;
                    changed = true;
                }

                // As ondas seguintes começam exatamente quando a anterior acaba
                for (let i = 1; i < updatedWaves.length; i++) {
                    const prevWave = updatedWaves[i - 1];
                    const durationInMinutes = prevWave.duration / 60;
                    const nextStartTime = addMinutesToTime(prevWave.startTime, durationInMinutes);
                    
                    if (updatedWaves[i].startTime !== nextStartTime) {
                        updatedWaves[i].startTime = nextStartTime;
                        changed = true;
                    }
                }

                if (changed) {
                    setWaves(updatedWaves);
                }
            }, [scheduledStartTime, waves.map(w => w.duration).join(',')]);

            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    const nowStr = now.toLocaleTimeString('pt-PT', {hour: '2-digit', minute:'2-digit'});
                    setSystemTime(nowStr);

                    if (isAutoStartEnabled && !isRunning && activeWaveIndex === 0 && timeLeft === waves[0].duration) {
                        if (nowStr === scheduledStartTime) {
                            toggleTimer();
                        }
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, [isAutoStartEnabled, isRunning, scheduledStartTime, activeWaveIndex, timeLeft]);

            useEffect(() => {
                const loadVoices = () => {
                    const voices = window.speechSynthesis.getVoices();
                    const ptVoices = voices.filter(v => v.lang.startsWith('pt'));
                    setAvailableVoices(ptVoices);
                    if (ptVoices.length > 0 && !selectedVoiceName) {
                        setSelectedVoiceName(ptVoices[0].name);
                    }
                };
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, [selectedVoiceName]);

            const playHorn = useCallback(() => {
                if (isMuted || !isHornEnabled) return;
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const osc1 = audioCtx.createOscillator();
                const osc2 = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                osc1.type = 'square'; 
                osc2.type = 'sawtooth';
                osc1.frequency.setValueAtTime(350, audioCtx.currentTime);
                osc2.frequency.setValueAtTime(355, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 0.05);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.8);
                osc1.connect(gainNode);
                osc2.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                osc1.start();
                osc2.start();
                osc1.stop(audioCtx.currentTime + 0.8);
                osc2.stop(audioCtx.currentTime + 0.8);
                setTimeout(() => audioCtx.close(), 1000);
            }, [isMuted, isHornEnabled]);

            const speak = useCallback((text) => {
                if (isMuted) return;
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const voice = availableVoices.find(v => v.name === selectedVoiceName);
                if (voice) utterance.voice = voice;
                else utterance.lang = 'pt-PT';
                window.speechSynthesis.speak(utterance);
            }, [isMuted, selectedVoiceName, availableVoices]);

            useEffect(() => {
                if (isRunning && timeLeft > 0) {
                    timerRef.current = setInterval(() => setTimeLeft((prev) => prev - 1), 1000);
                } else if (timeLeft === 0 && isRunning) {
                    clearInterval(timerRef.current);
                    if (isHornEnabled) playHorn();
                    speak(`${waves[activeWaveIndex].name} finalizada.`);
                    setIsRunning(false);
                }
                return () => clearInterval(timerRef.current);
            }, [isRunning, timeLeft, activeWaveIndex, waves, speak, playHorn, isHornEnabled]);

            useEffect(() => {
                if (!isRunning || timeLeft <= 0) return;
                const triggerPointSeconds = alarmTriggerMinutes * 60;
                if (timeLeft <= triggerPointSeconds) {
                    const timePassedSinceTrigger = triggerPointSeconds - timeLeft;
                    if (timePassedSinceTrigger % alarmRepeatSeconds === 0) {
                        const mins = Math.floor(timeLeft / 60);
                        const secs = timeLeft % 60;
                        let timeMsg = "";
                        if (mins > 0) timeMsg += `${mins} minuto${mins > 1 ? 's' : ''}`;
                        if (secs > 0) timeMsg += `${mins > 0 ? ' e ' : ''}${secs} segundos`;
                        if (mins === 0 && secs === 0) return; 
                        if (isHornEnabled) playHorn();
                        setTimeout(() => {
                            speak(`ATENÇÃO, ${waves[activeWaveIndex].name} prestes a acabar. Restam ${timeMsg}.`);
                        }, isHornEnabled ? 500 : 0);
                    }
                }
            }, [timeLeft, isRunning, alarmTriggerMinutes, alarmRepeatSeconds, activeWaveIndex, waves, speak, playHorn, isHornEnabled]);

            const toggleTimer = () => {
                if (!isRunning && timeLeft === waves[activeWaveIndex].duration) {
                    speak(`Atenção time, vai iniciar a ${waves[activeWaveIndex].name}`);
                }
                setIsRunning(!isRunning);
            };

            const formatTime = (s) => `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
            const currentWave = waves[activeWaveIndex];
            const progress = ((currentWave.duration - timeLeft) / currentWave.duration) * 100;

            if (view === 'setup') {
                return (
                    <div className="p-6 md:p-12 max-w-2xl mx-auto">
                        <button onClick={() => setView('timer')} className="flex items-center gap-2 mb-8 text-slate-500 hover:text-slate-900 transition-colors font-bold">
                            <Icons.ArrowLeft /> Voltar ao Painel
                        </button>
                        <h1 className="text-3xl font-black mb-8 flex items-center gap-3 text-slate-900 uppercase">
                             Configurações
                        </h1>
                        
                        <div className="ml-card border border-slate-200 p-8 rounded-lg space-y-8 shadow-sm">
                            <div className="bg-slate-50 p-6 rounded-lg border border-ml-blue/20 space-y-4">
                                <h3 className="text-lg font-bold flex items-center gap-2 text-ml-blue uppercase tracking-tight">
                                    <Icons.Calendar /> Início do Dia
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-2">
                                        <label className="block text-xs font-bold text-slate-500 uppercase tracking-widest">Hora da 1ª Onda:</label>
                                        <input 
                                            type="time" 
                                            value={scheduledStartTime} 
                                            onChange={e => setScheduledStartTime(e.target.value)} 
                                            className="bg-white p-3 rounded-lg w-full border border-slate-300 focus:border-ml-blue outline-none font-mono font-bold"
                                        />
                                    </div>
                                    <div className="flex items-end">
                                        <button 
                                            onClick={() => setIsAutoStartEnabled(!isAutoStartEnabled)}
                                            className={`w-full p-3 rounded-lg font-bold transition-all border flex items-center justify-center gap-2 ${isAutoStartEnabled ? 'bg-ml-blue border-ml-blue text-white' : 'bg-white border-slate-300 text-slate-500 hover:bg-slate-50'}`}
                                        >
                                            {isAutoStartEnabled ? 'Início Auto: Ativo' : 'Ativar Início Auto'}
                                        </button>
                                    </div>
                                </div>
                                <p className="text-[10px] text-slate-400 font-semibold italic">
                                    * As ondas subsequentes são calculadas automaticamente com base no término da anterior.
                                </p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    <label className="block text-sm font-bold text-slate-600">Alerta (Minutos):</label>
                                    <input 
                                        type="number" 
                                        value={alarmTriggerMinutes} 
                                        onChange={e => setAlarmTriggerMinutes(parseFloat(e.target.value) || 0)} 
                                        className="bg-white p-3 rounded-lg w-full border border-slate-300 focus:border-ml-blue outline-none font-bold" 
                                        step="0.5"
                                    />
                                </div>
                                <div className="space-y-4">
                                    <label className="block text-sm font-bold text-slate-600">Repete a cada (Seg):</label>
                                    <input 
                                        type="number" 
                                        value={alarmRepeatSeconds} 
                                        onChange={e => setAlarmRepeatSeconds(parseInt(e.target.value) || 10)} 
                                        className="bg-white p-3 rounded-lg w-full border border-slate-300 focus:border-ml-blue outline-none font-bold" 
                                    />
                                </div>
                            </div>

                            <div className="flex items-center justify-between p-4 bg-slate-50 border border-slate-200 rounded-lg">
                                <div className="flex items-center gap-3 text-slate-800">
                                    <Icons.Bullhorn />
                                    <div>
                                        <p className="font-bold text-sm">Buzina Industrial</p>
                                        <p className="text-[10px] font-semibold text-slate-500 uppercase tracking-tighter">Sinal sonoro nos alertas</p>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => { setIsHornEnabled(!isHornEnabled); if(!isHornEnabled) playHorn(); }}
                                    className={`w-14 h-8 rounded-full transition-colors relative ${isHornEnabled ? 'bg-ml-blue' : 'bg-slate-300'}`}
                                >
                                    <div className={`absolute top-1 w-6 h-6 rounded-full transition-all bg-white ${isHornEnabled ? 'left-7' : 'left-1'}`} />
                                </button>
                            </div>

                            <div className="space-y-4">
                                <label className="block text-sm font-bold text-slate-600">Voz do Locutor:</label>
                                <select value={selectedVoiceName} onChange={e => setSelectedVoiceName(e.target.value)} className="bg-white p-3 rounded-lg w-full border border-slate-300 focus:border-ml-blue outline-none text-sm font-bold">
                                    {availableVoices.map(v => <option key={v.name} value={v.name}>{v.name}</option>)}
                                </select>
                            </div>

                            <div className="pt-6 border-t border-slate-200">
                                <h3 className="font-black mb-6 text-slate-500 uppercase tracking-widest text-[11px] text-center">Duração de cada Onda (Minutos)</h3>
                                <div className="grid gap-3">
                                    {waves.map((w, i) => (
                                        <div key={w.id} className="flex items-center gap-4 bg-slate-50 p-3 rounded-lg border border-slate-200 hover:border-ml-blue/30 transition-colors">
                                            <div className="w-24">
                                                <span className="font-bold text-slate-700 text-sm block">{w.name}</span>
                                                <span className="text-[10px] text-ml-blue font-black uppercase">Início: {w.startTime}</span>
                                            </div>
                                            <input type="number" value={w.duration/60} onChange={e => {
                                                const newWaves = [...waves];
                                                newWaves[i].duration = (parseFloat(e.target.value) || 0) * 60;
                                                setWaves(newWaves);
                                                if (i === activeWaveIndex) setTimeLeft(newWaves[i].duration);
                                            }} className="bg-white p-2 rounded-lg w-full text-center border border-slate-300 focus:border-ml-blue outline-none font-black text-lg" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="p-4 md:p-12 max-w-5xl mx-auto">
                    {/* Header Estilo Mercado Livre */}
                    <header className="flex justify-between items-center mb-6 bg-ml-yellow p-4 rounded-lg shadow-sm border-b border-yellow-400/30">
                        <div className="flex items-center gap-4 text-slate-900">
                            <div className="bg-white p-2 rounded-lg shadow-sm"><Icons.Package /></div>
                            <div>
                                <h1 className="text-xl font-black tracking-tight uppercase leading-none">Waves SSC7</h1>
                                <p className="text-slate-800 text-[10px] font-black uppercase tracking-widest mt-1">Lages, SC • Mercado Livre</p>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setView('setup')} className="p-3 bg-slate-900/10 rounded-lg hover:bg-slate-900/20 transition-all text-slate-900"><Icons.Settings /></button>
                            <button onClick={() => setIsMuted(!isMuted)} className={`p-3 rounded-lg transition-all shadow-sm font-bold flex items-center gap-2 ${isMuted ? 'bg-red-500 text-white' : 'bg-white text-slate-900'}`}>
                                {isMuted ? <Icons.VolumeX /> : <Icons.Volume2 />}
                                <span className="text-xs hidden md:inline">{isMuted ? 'Mudo' : 'Som'}</span>
                            </button>
                        </div>
                    </header>

                    <div className="ml-card border border-slate-200 rounded-lg p-8 md:p-14 text-center relative shadow-sm overflow-hidden">
                        <div className="relative z-10">
                            <div className="flex justify-center items-center gap-3 mb-8">
                                <span className={`px-5 py-2 rounded-full font-black uppercase tracking-[0.2em] text-xs border ${timeLeft <= alarmTriggerMinutes * 60 ? 'bg-red-500 text-white border-red-400' : 'bg-slate-100 text-slate-600 border-slate-200'}`}>
                                    {currentWave.name}
                                </span>
                                {isAutoStartEnabled && activeWaveIndex === 0 && timeLeft === waves[0].duration && !isRunning && (
                                    <span className="bg-ml-blue/10 text-ml-blue px-4 py-2 rounded-full font-black uppercase text-[10px] border border-ml-blue/20 flex items-center gap-2">
                                        <div className="w-2 h-2 bg-ml-blue rounded-full animate-pulse"></div>
                                        Agenda: {scheduledStartTime}
                                    </span>
                                )}
                            </div>

                            <div className={`text-9xl md:text-[13rem] font-black my-4 font-mono tracking-tighter leading-none transition-all duration-500 ${timeLeft <= alarmTriggerMinutes * 60 ? 'text-red-500' : 'text-slate-900'}`}>
                                {formatTime(timeLeft)}
                            </div>
                            
                            <div className="max-w-md mx-auto mb-14">
                                <div className="w-full bg-slate-100 h-6 rounded-full overflow-hidden border border-slate-200 p-1 shadow-inner">
                                    <div className={`h-full rounded-full transition-all duration-1000 ${timeLeft <= alarmTriggerMinutes * 60 ? 'bg-red-500' : 'bg-ml-yellow'}`} style={{width: `${progress}%`}}></div>
                                </div>
                            </div>

                            <div className="flex flex-wrap justify-center gap-4">
                                <button onClick={() => { setIsRunning(false); setTimeLeft(currentWave.duration); }} className="bg-slate-100 text-slate-700 px-8 py-5 rounded-lg hover:bg-slate-200 transition-all font-bold flex items-center gap-3 border border-slate-200"><Icons.RotateCcw /> Reset</button>
                                <button onClick={toggleTimer} className={`px-16 py-5 rounded-lg font-black flex items-center gap-3 transition-all transform active:scale-95 shadow-md ${isRunning ? 'bg-ml-blue text-white' : 'bg-ml-yellow text-slate-950 hover:brightness-105'}`}>
                                    {isRunning ? <><Icons.Pause /> Pausar</> : <><Icons.Play /> Iniciar</>}
                                </button>
                                {timeLeft === 0 && activeWaveIndex < waves.length - 1 && (
                                    <button onClick={() => {
                                        const next = activeWaveIndex + 1;
                                        setActiveWaveIndex(next);
                                        setTimeLeft(waves[next].duration);
                                        speak(`Atenção, iniciando a ${waves[next].name}`);
                                    }} className="bg-ml-blue px-10 py-5 rounded-lg font-black text-white hover:brightness-110 transition-all shadow-md animate-bounce">Próxima</button>
                                )}
                            </div>
                        </div>
                        
                        <div className="absolute -bottom-20 -right-20 opacity-[0.05] rotate-12 pointer-events-none text-slate-900">
                            <Icons.Package size={550} />
                        </div>
                    </div>

                    <div className="mt-8 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
                        {waves.map((w, i) => (
                            <div key={w.id} className={`p-6 rounded-lg border transition-all ${i === activeWaveIndex ? 'border-ml-yellow bg-ml-yellow/10 shadow-sm scale-105' : i < activeWaveIndex ? 'border-slate-200 bg-slate-50 opacity-40 grayscale' : 'border-slate-200 bg-white opacity-80 hover:opacity-100'}`}>
                                <div className="text-[10px] font-black text-slate-400 uppercase mb-2 tracking-tighter">{i < activeWaveIndex ? 'Concluída' : i === activeWaveIndex ? 'Em Curso' : 'Aguardando'}</div>
                                <div className="text-sm font-black text-slate-800">{w.name}</div>
                                <div className="text-lg font-mono font-black text-ml-blue/70 leading-none mt-1">{w.startTime}</div>
                            </div>
                        ))}
                    </div>

                    <footer className="mt-12 flex flex-wrap justify-center gap-4">
                        <div className="inline-flex items-center gap-2 bg-white border border-slate-200 px-5 py-2 rounded-lg text-[10px] font-black text-slate-500 uppercase tracking-widest shadow-sm">
                            <Icons.Clock /> {systemTime}
                        </div>
                        {isAutoStartEnabled && (
                            <div className="inline-flex items-center gap-2 bg-ml-blue/5 border border-ml-blue/20 px-5 py-2 rounded-lg text-[10px] font-black text-ml-blue uppercase tracking-widest shadow-sm">
                                <Icons.Calendar /> Início Auto: {scheduledStartTime}
                            </div>
                        )}
                        <div className="inline-flex items-center gap-2 bg-white border border-slate-200 px-5 py-2 rounded-lg text-[10px] font-black text-red-500/80 uppercase tracking-widest shadow-sm">
                            <Icons.Bell /> Repete Alerta: {alarmRepeatSeconds}s
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>